\documentclass{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{algorithmicx}
\usepackage{algpseudocode}
\usepackage{algorithm}
\newcommand*\Let[2]{\State #1 $\gets$ #2}

\begin{document}
\section{Simulation of the PDEs}
\subsection{Model Equations}
Let $u= (u_1,u_2)$ be the velocity, where $u_1,u_2: \Omega \times [0,\infty) \to \mathbb{R}$ and $p: \Omega \times [0,\infty) \to \mathbb{R}$ the pressure and $T : \Omega \times [0,\infty) \to \mathbb{R}$ the temperature variable. We then get the scalar equations:
\begin{align}
\frac{\partial u_1}{\partial t} + \langle u,\nabla u_1\rangle  &= -\frac{1}{\rho}\frac{\partial p}{\partial x}  + \nu \nabla^2 u_1 - g_1\alpha (T-T_0) \label{modeleq:1}\\
\frac{\partial u_2}{\partial t} + \langle u,\nabla u_2\rangle  &= -\frac{1}{\rho}\frac{\partial p}{\partial y} + \nu \nabla^2 u_2 - g_2\alpha (T-T_0) \label{modeleq:2}\\
\frac{\partial u_1}{\partial x_1} + \frac{\partial u_2}{\partial x_2} &= \varepsilon p \label{modeleq:3}\\
\frac{\partial T}{\partial t} + \langle u,\nabla T\rangle &= \kappa \nabla^2 T \label{modeleq:4}
\end{align}
where 
\begin{align*}
	g = \left(g_1,g_2\right)^T &: \text{gravitational acceleration}\\
	\rho &: \text{density of the fluid} \\
	\nu &: \text{kinematic viscosity} \\
	\alpha &: \text{coefficient of expansion} \\
	\kappa &: \text{thermal diffusivity} \\
	\varepsilon &: \text{regularisation parameter} \\
	T_0 &: \text{a reference temperature}
\end{align*}
with boundary conditions
\begin{align}
u_1 = u_2 &= 0 \quad &\text{ on } \Gamma\\
T &= T_\text{dir}\quad &\text{ on } \Gamma_1\\
\partial_\eta T = \langle \nabla T, \eta \rangle &= \gamma (T-T_\text{out}) \quad &\text{ on } \Gamma \setminus\Gamma_1
\end{align}
where
\begin{align*}
 \eta &: \text{outer normal of the boundary} \\
T_\text{dir} &: \text{heating} \\
T_\text{out} &: \text{outside temperature} \\
\gamma &: \text{thermal conductivity of the boundary}
 \end{align*}
 \subsection{Implicit Euler discretisation in time}
If we have a differential equation, e.g for $u_1$
\begin{align*}
	\frac{\partial u_1}{\partial t} = F(u_1,u_2,p,T)
\end{align*}
we can apply implicit Euler with a timestep $\delta t$ to get
\begin{align}
\label{Eulerscheme}
	\frac{u_1^\text{new}-u_1^\text{old}}{\delta t} = F(u_1^\text{new},u_2,p,T)
\end{align}
where we now have find the root $u_1$ of the Function
\begin{align*}
u_1-u_1^\text{old} - \delta tF(u_1,u_2,p,T)
\end{align*}
 \subsection{Weak formulation}
Testing each line  $(\ref{modeleq:1})-(\ref{modeleq:4})$ with a test function $v_i,i\in \{1,\dots,4\}$ and integrating over the domain $\Omega$ we can now define 
 \begin{align}
F_1(u_1,u_2,p,T)v_1 &:= \int\limits_\Omega \left(-\langle u,\nabla u_1\rangle -\frac{1}{\rho}\frac{\partial p}{\partial x} + \nu \nabla^2 u_1 - g_1\alpha (T-T_0)\right)v_1\text{d}\omega \label{F:1}\\
F_2(u_1,u_2,p,T)v_2 &:=\int\limits_\Omega \left(-\langle u,\nabla u_2\rangle  -\frac{1}{\rho}\frac{\partial p}{\partial y} + \nu \nabla^2 u_2 - g_2\alpha (T-T_0)\right)v_2\text{d}\omega \label{F:2}\\
F_3(u_1,u_2,p,T)v_3 &:= \int\limits_\Omega\left(\varepsilon p -  \frac{\partial u_1}{\partial x_1} - \frac{\partial u_2}{\partial x_2}\right)v_3\text{d}\omega\label{F:3}\\
F_4(u_1,u_2,p,T)v_4 &:=\int\limits_\Omega \left(-\langle u,\nabla T\rangle+ \kappa \nabla^2 T\right)v_4 \text{d}\omega\label{F:4}
 \end{align}
 partial integration and using the boundary conditions yields: \\(remember, $\nabla^2 u_1 = \Delta u_1 = \sum\limits_i \frac{\partial^2 u_1}{\partial^2 x_i}$)
 \begin{align*}
 F_1(u_1,u_2,p,T)v_1 &= \int\limits_\Omega \left(-\langle u,\nabla u_1\rangle -\frac{1}{\rho}\frac{\partial p}{\partial x} - g_1\alpha (T-T_0)\right)v_1 + \nu \nabla^2 u_1 v_1 \text{d}\omega \\
 &= \int\limits_\Omega \left(-\langle u,\nabla u_1\rangle -\frac{1}{\rho}\frac{\partial p}{\partial x} - g_1\alpha (T-T_0)\right)v_1 - \nu \langle \nabla u_1,\nabla v_1 \rangle \text{d}\omega + \int\limits_\Gamma \nu \langle \nabla u_1,\eta\rangle v_1 \text{d}s \\
 &= \int\limits_\Omega \left(-\langle u,\nabla u_1\rangle -\frac{1}{\rho}\frac{\partial p}{\partial x} - g_1\alpha (T-T_0)\right)v_1 - \nu \langle \nabla u_1,\nabla v_1 \rangle \text{d}\omega,  \quad \text{as }v_1 = 0 \text{ on } \Gamma \\
 F_2(u_1,u_2,p,T)v_2 &= \int\limits_\Omega \left(-\langle u,\nabla u_2\rangle -\frac{1}{\rho}\frac{\partial p}{\partial y} - g_2\alpha (T-T_0)\right)v_2 - \nu \langle \nabla u_2,\nabla v_2 \rangle \text{d}\omega + \int\limits_\Gamma \nu \langle \nabla u_2,\eta\rangle v_2 \text{d}s\\
 &= \int\limits_\Omega \left(-\langle u,\nabla u_2\rangle -\frac{1}{\rho}\frac{\partial p}{\partial y} - g_2\alpha (T-T_0)\right)v_2 - \nu \langle \nabla u_2,\nabla v_2 \rangle \text{d}\omega \quad \text{as }v_2 = 0 \text{ on } \Gamma \\\\
 F_4(u_1,u_2,p,T)v_4 &=\int\limits_\Omega \left(-\langle u,\nabla T\rangle+ \kappa \nabla^2 T\right)v_4 \text{d}\omega\\
 &=\int\limits_\Omega -\langle u,\nabla T\rangle v_4 - \kappa \langle\nabla T,\nabla v_4\rangle \text{d}\omega + \int\limits_\Gamma \kappa \langle \nabla T,\eta \rangle v_4\text{d}s\\
 &=\int\limits_\Omega -\langle u,\nabla T\rangle v_4 - \kappa \langle\nabla T,\nabla v_4\rangle \text{d}\omega + \int\limits_{\Gamma_1} \kappa \langle \nabla T,\eta \rangle v_4\text{d}s + \int\limits_{\Gamma \setminus \Gamma_1} \kappa \langle \nabla T,\eta \rangle v_4\text{d}s\\
 &=\int\limits_\Omega -\langle u,\nabla T\rangle v_4 - \kappa \langle\nabla T,\nabla v_4\rangle \text{d}\omega + \int\limits_{\Gamma_1} \kappa \langle \nabla T,\eta \rangle v_4\text{d}s + \int\limits_{\Gamma \setminus \Gamma_1} \kappa \gamma(T-T_\text{out}) v_4\text{d}s\\
 \end{align*}
 \subsection{Newton's method on the implicit Euler equation}
 Using the considerations of the last two subsections, we define
 \begin{align*}
 G(u_1,u_2,p,T) = 
 \begin{pmatrix}
\int\limits_\Omega (u_1- u_1^\text{old})v_1 \text{d}\omega -\delta t F_1(u_1,u_2,p,T)v_1\\
\int\limits_\Omega (u_2- u_2^\text{old})v_2 \text{d}\omega -\delta t F_2(u_1,u_2,p,T)v_2\\
F_3(u_1,u_2,p,T)v_3\\
\int\limits_\Omega (T- T^\text{old})v_4 \text{d}\omega -\delta t F_4(u_1,u_2,p,T)v_4\\
 \end{pmatrix}
 \end{align*}
 We now want to find $(u_1,u_2,p,T)^T$ such that $G(u_1,u_2,p,T) = 0$. Applying Newton's method on the function $G$, we get the iteration
 \begin{align*}
\begin{pmatrix}
u_1^{i+1}\\
u_2^{i+1}\\
p^{i+1}\\
T^{i+1}\\
\end{pmatrix}
=\begin{pmatrix}
u_1^{i}\\
u_2^{i}\\
p^{i}\\
T^{i}\\
\end{pmatrix}
+
\begin{pmatrix}
\delta u_1^{i}\\
\delta u_2^{i}\\
\delta p^{i}\\
\delta T^{i}\\
\end{pmatrix}
 \end{align*}
 where 
 \begin{align*}
G'(u_1^i,u_2^i,p^i,T^i)\begin{pmatrix}
\delta u_1^{i}\\
\delta u_2^{i}\\
\delta p^{i}\\
\delta T^{i}\\
\end{pmatrix} = -G(u_1^i,u_2^i,p^i,T^i)
 \end{align*}
and 
 \begin{align*}
G'(u_1^i,u_2^i,p^i,T^i) = \begin{pmatrix}
\frac{\partial G_1}{\partial u_1}&\frac{\partial G_1}{\partial u_2}&\frac{\partial G_1}{\partial p}&\frac{\partial G_1}{\partial T}\\
\frac{\partial G_2}{\partial u_1}&\frac{\partial G_2}{\partial u_2}&\frac{\partial G_2}{\partial p}&\frac{\partial G_2}{\partial T}\\
\frac{\partial G_3}{\partial u_1}&\frac{\partial G_3}{\partial u_2}&\frac{\partial G_3}{\partial p}&\frac{\partial G_3}{\partial T}\\
\frac{\partial G_4}{\partial u_1}&\frac{\partial G_4}{\partial u_2}&\frac{\partial G_4}{\partial p}&\frac{\partial G_4}{\partial T}\\
\end{pmatrix}
 \end{align*}
\subsection{Simplifications of the system}
Consider a Function $G(z) = C + Az + N(z)$, where $C$ is a constant, $Az$ is the linear and $N(z)$ is the nonlinear part of the function. If we apply Newton's method to find a root of $G(z)$, using $\delta z^i = z^{i+1}-z^{i}$, we have to solve
\begin{align}
\label{newtoneq}
G'(z^i)\delta z &= -G(z^i) \\
\Leftrightarrow  \qquad (A+N'(z^i))(z^{i+1}-z^i) &= -\left(C + Az^i + N(z^i)\right)
\end{align}
and solve this for $z^{i+1}$ we obtain
\begin{align*}
(A+N'(z^i))(z^{i+1}) = -C - Az^i - N(z^i) +(A+N'(z^i))z_i = -C-N(z^i) + N'(z^i)z^i
\end{align*}
In our context, we split up $G_i(u_1,u_2,p,T),i\in \{1,\dots,4\}$ and get
\begin{align*}
C_{G_1} &= -\int\limits_{\Omega}u_1^\text{old}v_1\text{d}\omega-\delta tC_{F_1} =-\int\limits_{\Omega}u_1^\text{old}v_1\text{d}\omega -\delta t\int\limits_\Omega g_1\alpha T_0 v_1 \text{d}\omega \\
C_{G_2} &= -\int\limits_{\Omega}u_2^\text{old}v_2\text{d}\omega-\delta tC_{F_2} =-\int\limits_{\Omega}u_2^\text{old}v_2\text{d}\omega -\delta t\int\limits_\Omega g_2\alpha T_0 v_2 \text{d}\omega \\
C_{G_3} &= C_{F_3} = 0 \\
C_{G_4} &= -\int\limits_{\Omega}T^\text{old}v_4\text{d}\omega-\delta tC_{F_4} =-\int\limits_{\Omega}T^\text{old}v_4\text{d}\omega + \delta t\int\limits_{\Gamma\setminus\Gamma_1} \kappa\gamma T_\text{out} v_3\text{d}\omega
\end{align*}
for the constant part and for the left hand side linear part
\begin{align*}
A_{G_1}z^{i+1} &= \int\limits_\Omega u_1^{i+1} v_1 \text{d}\omega - \delta tA_{F_1}z^{i+1} \\
&= \int\limits_\Omega u_1^{i+1} v_1 \text{d}\omega - \delta t\left[\int\limits_\Omega \left(-\frac{1}{\rho}\frac{\partial p^{i+1}}{\partial x}-g_1\alpha T^{i+1}\right)v_1 - \nu\langle \nabla u_1^{i+1},\nabla v_1\rangle \text{d}\omega\right]\\
&= \int\limits_\Omega u_1^{i+1} v_1 \text{d}\omega + \delta t\int\limits_\Omega \left(\frac{1}{\rho}\frac{\partial p^{i+1}}{\partial x}+g_1\alpha T^{i+1}\right)v_1 + \nu\langle \nabla u_1^{i+1},\nabla v_1\rangle \text{d}\omega\\
A_{G_2}z^{i+1} &= \int\limits_\Omega u_2^{i+1} v_2 \text{d}\omega - \delta tA_{F_2}z^{i+1} \\
&= \int\limits_\Omega u_2^{i+1} v_2 \text{d}\omega - \delta t\left[\int\limits_\Omega \left(-\frac{1}{\rho}\frac{\partial p^{i+1}}{\partial y}-g_2\alpha T^{i+1}\right)v_2 - \nu\langle \nabla u_2^{i+1},\nabla v_2\rangle \text{d}\omega\right]\\
&= \int\limits_\Omega u_2^{i+1} v_2 \text{d}\omega + \delta t\int\limits_\Omega \left(\frac{1}{\rho}\frac{\partial p^{i+1}}{\partial y}+g_2\alpha T^{i+1}\right)v_2 + \nu\langle \nabla u_2^{i+1},\nabla v_2\rangle \text{d}\omega\\
A_{G_3}z^{i+1} &= \delta tA_{F_3} z^{i+1} \\
&= \int\limits_\Omega (\varepsilon p^{i+1} - \frac{\partial u_1^{i+1}}{\partial x} - \frac{\partial u_2^{i+1}}{\partial y})v_3\\
A_{G_4}z^{i+1} &= \int\limits_\Omega T^{i+1} v_4 \text{d}\omega - \delta tA_{F_4}z^{i+1} \\
&= \int\limits_\Omega T^{i+1} v_4 \text{d}\omega -\delta t\left(\int\limits_\Omega -\kappa \langle \nabla T^{i+1},\nabla v_4\rangle \text{d}\omega + \int\limits_{\Gamma_1} \kappa\langle \nabla T^{i+1},\eta\rangle v_4 \text{d}s + \int\limits_{\Gamma \setminus \Gamma_1}\kappa\gamma T^{i+1}v_4\text{d}s\right) \\
&= \int\limits_\Omega T^{i+1} v_4 \text{d}\omega +\delta t\left( \int\limits_\Omega \kappa \langle \nabla T^{i+1},\nabla v_4\rangle \text{d}\omega - \int\limits_{\Gamma_1} \kappa\langle \nabla T^{i+1},\eta\rangle v_4 \text{d}s - \int\limits_{\Gamma \setminus \Gamma_1}\kappa\gamma T^{i+1}v_4\text{d}s\right)
\end{align*}
To get the nonlinear part $N(z^i)$ and its linearization $N'(z^i)z^i$ and $N'(z^i)z^{i+1}$ respectively, we first compute with $w$ being a test function
\begin{align*}
&\frac{\partial}{\partial u_1}(\langle u,\nabla u_1\rangle) w \\
=& \frac{\partial}{\partial u_1}(u_1 \frac{\partial u_1}{\partial x} + u_2 \frac{\partial u_1}{\partial y}) w\\
=& w\frac{\partial u_1}{\partial x}+ u_1\frac{\partial w}{\partial x}+ u_2 \frac{\partial w}{\partial y}\qquad \qquad \text{product rule}
\end{align*}
and 
\begin{align*}
&\frac{\partial}{\partial u_2}(\langle u,\nabla u_2\rangle) w  \\
=& \frac{\partial}{\partial u_2}(u_1 \frac{\partial u_2}{\partial x} + u_2 \frac{\partial u_2}{\partial y}) w\\
=& u_1\frac{\partial w}{\partial x}+ w\frac{\partial u_2}{\partial y}+ u_2 \frac{\partial w}{\partial y}\qquad \qquad \text{product rule}
\end{align*}
We then obtain
\begin{align*}
N_{G_1}(z^i) = &-\delta t N_{F_1}(z^i)\\
= &\int\limits_\Omega \langle u^i ,\nabla u_1^i \rangle v_1 \text{d}\omega\\
N'_{G_1}(z^i)z^{i+1} = &-\delta t N_{F_1}'(z^i)z^{i+1}\\
= &\delta t\int\limits_\Omega ( \underbrace{u_1^{i+1}\frac{\partial u_1^i}{\partial x} + u_1^i\frac{\partial u_1^{i+1}}{\partial x} + u_2^{i}\frac{\partial u_1^{i+1}}{\partial y}}_{-(\frac{\partial N_{F_1}(z_i)}{\partial u_1})u_1^{i+1}} 
+ \underbrace{ u_2^{i+1} \frac{\partial u_1^i}{\partial y}}_{-(\frac{\partial N_{F_1}(z_i)}{\partial u_2})u_2^{i+1}} ) v_1\text{d}\omega \\
N_{G_2}(z^i) = &-\delta t N_{F_2}(z^i)\\
= &\int\limits_\Omega \langle u^i ,\nabla u_2^i \rangle v_2 \text{d}\omega\\
N'_{G_2}(z^i)z^{i+1} = &-\delta t N_{F_2}'(z^i)z^{i+1}\\
= & \delta t\int\limits_\Omega ( \underbrace{u_1^{i}\frac{\partial u_2^{i+1}}{\partial x} + u_2^{i+1}\frac{\partial u_2^{i}}{\partial y} + u_2^{i}\frac{\partial u_2^{i+1}}{\partial y}}_{-(\frac{\partial N_{F_2}(z_i)}{\partial u_2})u_2^{i+1}} 
+ \underbrace{ u_1^{i+1} \frac{\partial u_2^i}{\partial x}}_{-(\frac{\partial N_{F_2}(z_i)}{\partial u_1})u_1^{i+1}} ) v_2\text{d}\omega \\
N_{G_3}(z^i) =& 0 \\
N_{G_4}(z^i) =& -\delta t N_{F_4}(z^i)\\
=& \delta t\int\limits_\Omega \langle u,\nabla T\rangle v_4 \text{d}\omega \\
N'_{G_4}(z^i)z^{i+1} = &-\delta t N_{F_4}'(z^i)z^{i+1}\\
=& \delta t \int\limits_\Omega  (\underbrace{u_1^{i+1}\frac{\partial T^{i}}{\partial x}}_{-(\frac{\partial N_{F_4}(z^i)}{\partial u_1})u_1^{i+1}}+ \underbrace{u_2^{i+1}\frac{\partial T^{i}}{\partial y}}_{-(\frac{\partial N_{F_4}(z^i)}{\partial u_2})u_2^{i+1} }+\underbrace{\langle u^i,\nabla T^{i+1}\rangle }_{-(\frac{\partial N_{F_4}(z^i)}{\partial T})T^{i+1}})v_4 \text{d}\omega
\end{align*}
\subsection{Formulation as linear equation system}
Using a Finite Element discretisation, we obtain finite dimensional spaces $V_i,i\in\{1,\dots,4\}$, where we can just use the Basis functions $\Phi_j,j\in \{1,\dots,N\}$ for each space as test functions $v_i,\in\{1,\dots,4\}$. This gives the lines of the equation system. Furthermore, the variables $u_1,u_2,p$ and $T$ are linear combinations of these basis functions. Hence we have, e.g for the temperature $T^{i+1}$ in the next Newton step
\begin{align*}
T^{i+1} = \sum\limits_{j=1}^{N} \bar{T}_j^{i+1}\Phi_j^{i+1}
\end{align*}
with coefficients $\bar{T}_j^{i+1} \in \mathbb{R}$. 
\subsection{Solutions of the linear equation system}
\subsubsection{No Temperature}
If we consider the case without the temperature, we obtain a linear system with a saddle point matrix
\begin{align*}
\begin{pmatrix}
M_{11}&M_{12}\\
M_{21}&M_{22}
\end{pmatrix}
\begin{pmatrix}
u^{i+1}\\p^{i+1}
\end{pmatrix}
=
\begin{pmatrix}
b\\0
\end{pmatrix},
\end{align*}
where $u=(u_1,u_2)$.\\
Note, that $M_{22}=0$, if $\varepsilon= 0$ in the continuity equation. In this case, we obtain a unsymmetric, indefinite saddle point matrix. where $M_{12}$ is the gradient and $M_{21}$ the diffusion operator (with boundary conditions), where $M_{11}$ stems from the (nonlinear) advection diffusion part.\\ An indeph overview of numerical methods can be found in \cite{BenziNumSolSaddle}, choices for preconditioners in \cite{ZulehnerPreconditionersPDE,twoprecond07}. In \cite{twoprecond07} the SIMPLE and SIMPLER method for preconditioning are presented. \\A possible solution of these systems is by the GMRES method, augmented with an inexact Schur preconditioner $P:X^\star \to X$, namely performs the operation
\begin{enumerate}
\item solve $M_{21} \tilde{M_{11}}^{-1}M_{12} p = D\tilde{M_{11}}^{-1}r_1$
\item solve $\tilde{M_{11}} u = r_1-Gp$
\end{enumerate}
where $\tilde{M_{11}}$ could be the diagonal of $M_{11}$ (SIMPLE method). Note that, if we used $\tilde{M_{11}} =M_{11}$, we converge in one step, as the precondition operation yields the solution. 
Using the library libmesh, with PETsc as backend, this can be achieved by passing
\begin{itemize}
\item -pc\_type\ fieldsplit $\rightarrow$ use fieldsplit preconditioner
\item -pc\_fieldsplit\_type schur $\rightarrow$ use Schur-comp as preconditioner
\item -pc\_fieldsplit\_detect\_saddle\_point $\rightarrow$ automatic detection of blocks
\item -pc\_fieldsplit\_schur\_fact\_type $<$full,diag,upper...$>$ $\rightarrow$ how does $\tilde{M_{11}}$ evolve from $M_{11}$.
\end{itemize}
as command line arguments for setting the preconditioner, and
\begin{itemize}
\item -ksp\_type $<$richardson,chebyshev,cg,bicg,gmres..$>$
\end{itemize}
as Krylov solver. GMRES is the default here.

\section{Affine covariant Newton algorithms}
Defined by \ref{newtoneq}, we will compute the Newton step $\delta z$ at iteration point $z$. Afterwards, we will compute another (simplified) Newton step, via the solution of
\begin{align*}
G'(z)\bar{\delta z}= -\left(G(z+\delta z) - G(z) - G'(z)\delta z\right)
\end{align*}
In the absence of damping, i.e $- G(z) - G'(z)\delta z=0$, this yields a second Newton step after $\delta z$, with derivative information at $z$. The idea is now, to estimate the Newton contraction
\begin{align*}
\Theta_{z_\star}(x_k) := \frac{\|z_{k+1}-z_\star\|}{\|z_{k}-z_\star\|} = \frac{\|G'(z_k)^{-1}\left(G'(z_k)(z_\star-z_k)-(G(z_\star) - G(z_k)\right)\|}{\|z_k-z_\star\|}
\end{align*}
by $z_+ = z - G'(z)^{-1}G(z) = z+\delta z$:
\begin{align*}
\Theta_{z_+}(x) := \frac{\|G'(z)^{-1}\left(G'(z)(z_+-z)-(G(z_+) - G(z_k)\right)\|}{\|z_k-z_\star\|}
\end{align*}
and to extend this to a model around $z$ with
\begin{align*}
[\Theta]_{z_+}(\xi) = \frac{[\omega]}{2}\|\xi-z_+\|
\end{align*}
and to choose $[\omega]$ such that
\begin{align*}
[\Theta]_{z_+}(z) = \Theta_{x_+}(x) = \frac{\|\bar{\delta z}\|}{\|\delta z\|}\qquad \Rightarrow \qquad [\omega]= \frac{2\|\bar{\delta z}\|}{\|\delta z\|^2}
\end{align*}
\subsection{Globalization by damping}
The problem $G(z)=0$ might be too difficult, and our starting guess (even the one computed with the explicit Euler) might be too far away from the solution.\\
\algdef{SE}[DOWHILE]{Do}{doWhile}{\algorithmicdo}[1]{\algorithmicwhile\ #1}%
\begin{algorithm}[H]
	\caption{Damped Newton's method}
	\label{alg::quaddampeningbefore}
	\begin{algorithmic}
		\Require{iterate $z, [\omega]$}
		\Repeat{// step computation loop}
		\State solve $G'(z)\delta z + G(z) = 0$.
		\Do
		\State compute $\lambda = \min\{1,\frac{1}{\|\delta z\|[\omega]}\}$
		\State solve $G'(z)\bar{\delta z}+G(z+\lambda\delta z)$ = 0.
		\State compute $[\omega] = \frac{\|\bar{\delta z}-(1-\lambda)\delta z\|}{\|\lambda\delta z\|^2}$
		\State \qquad $\Theta_{z+\lambda\delta z}(z) = \frac{[\omega]}{2}\|\lambda\delta z\|$
		\doWhile {$\Theta_{z+\lambda\delta z}(z)\geq 1$} (divergence)
		\Let{$z_+$}{$z+\lambda\delta z$}
		\If{$\lambda =1$ and $\Theta_{z_+}(z)\leq 0.5$ and $\|\delta z\|\leq \text{TOL}$}
		\Let{$z_+ + \bar{\delta z}$} terminate "desired accuracy needed"
		\EndIf
		\Let{$z$}{$z_+$}
		\Until{}	
	\end{algorithmic}
\end{algorithm}
\bibliographystyle{abbrv}
\bibliography{bib}
\end{document}